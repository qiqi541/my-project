import time
from kafka import KafkaProducer
import json
import os

# Kafka配置
KAFKA_BROKER = os.getenv("KAFKA_BROKER", "kafka:9092")
TOPIC = os.getenv("TOPIC", "runner-events")

def send_to_kafka(producer, message):
    producer.send(TOPIC, value=message)
    producer.flush()

def main():
    print("Runner started. Sending messages to Kafka...")
    producer = KafkaProducer(
        bootstrap_servers=[KAFKA_BROKER],
        value_serializer=lambda v: json.dumps(v).encode('utf-8')
    )

    for i in range(5):
        message = {"heartbeat": i, "timestamp": time.time()}
        print(f"[Kafka] Sending heartbeat {i}")
        send_to_kafka(producer, message)
        time.sleep(2)

    print("Runner finished sending messages.")

if __name__ == "__main__":
    main()
