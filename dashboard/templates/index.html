<!DOCTYPE html>
<html>
<head>
    <title>ç½‘ç»œå®‰å…¨æ€åŠ¿æ„ŸçŸ¥</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta http-equiv="refresh" content="3">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #1e1e2f; color: #fff; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { text-align: center; color: #00d4ff; letter-spacing: 2px; }

        /* é¡¶éƒ¨å¡ç‰‡åŒº */
        .stats-row { display: flex; justify-content: space-between; gap: 20px; margin-bottom: 20px; }
        .card { background: #27293d; padding: 20px; border-radius: 8px; flex: 1; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .number { font-size: 32px; font-weight: bold; margin-top: 5px; }

        /* å›¾è¡¨åŒº - æ”¹ä¸ºå¹¶æ’æ˜¾ç¤º */
        .charts-row { display: flex; gap: 20px; margin-bottom: 20px; height: 250px; }
        .chart-box { background: #27293d; flex: 1; padding: 15px; border-radius: 8px; position: relative; }

        /* è¡¨æ ¼åŒº */
        table { width: 100%; border-collapse: collapse; background: #27293d; border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #3d3f54; font-size: 14px; }
        th { background-color: #34364a; color: #00d4ff; }

        /* é£é™©ç­‰çº§æ ‡ç­¾æ ·å¼ */
        .tag { padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .tag-HIGH { background: #ff3b3b; color: white; }
        .tag-MEDIUM { background: #ff9f43; color: white; }
        .tag-LOW { background: #00d2d3; color: black; }
        .tag-INFO { background: #576574; color: white; }
    </style>
</head>
<body>
   <div class="container">
    <div style="text-align: right; margin-bottom: 10px;">
        <a href="/logout" style="color: #00d4ff; text-decoration: none; border: 1px solid #00d4ff; padding: 5px 15px; border-radius: 4px;">é€€å‡ºç³»ç»Ÿ (Logout)</a>
    </div>
    <h1>ğŸ›¡ï¸ å¯†ç åº”ç”¨æ¼æ´å¤ç°ä¸éªŒè¯ç³»ç»Ÿ</h1>
    <div class="stats-row">
            <div class="card"><div>æ€»æ”»å‡»æ•°</div><div class="number">{{ total }}</div></div>
            <div class="card"><div>é«˜å±æ¼æ´ (High)</div><div class="number" style="color:#ff3b3b">{{ risks.HIGH }}</div></div>
            <div class="card"><div>ä¸­å±æ¼æ´ (Medium)</div><div class="number" style="color:#ff9f43">{{ risks.MEDIUM }}</div></div>
            <div class="card"><div>ä½å±æ¼æ´ (Low)</div><div class="number" style="color:#00d2d3">{{ risks.LOW }}</div></div>
        </div>

        <div class="charts-row">
            <div class="chart-box">
                <canvas id="pieChart"></canvas>
            </div>
            <div class="chart-box">
                <canvas id="barChart"></canvas>
            </div>
        </div>

        <h3>ğŸš€ å®æ—¶å¨èƒæƒ…æŠ¥ (Recent Logs)</h3>
        <table>
            <thead>
                <tr><th>æ—¶é—´</th><th>é£é™©ç­‰çº§</th><th>æ”»å‡»ç±»å‹</th><th>Payload</th><th>ç»“æœ</th></tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ "%.0f"|format(log[0]) }}</td>
                    <td><span class="tag tag-{{ log[5] }}">{{ log[5] }}</span></td>
                    <td>{{ log[1] }}</td>
                    <td style="font-family: monospace; color: #a4b0be;">{{ log[2] }}</td>
                    <td style="color: {{ '#2ecc71' if log[4]=='success' else '#747d8c' }}">{{ log[4].upper() }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        // 1. é¥¼å›¾ï¼šæˆåŠŸç‡
        new Chart(document.getElementById('pieChart'), {
            type: 'doughnut',
            data: {
                labels: ['æ¼æ´åˆ©ç”¨æˆåŠŸ', 'é˜²å¾¡/å¤±è´¥'],
                datasets: [{
                    data: [{{ success }}, {{ fail }}],
                    backgroundColor: ['#ff4757', '#2ed573'],
                    borderWidth: 0
                }]
            },
            options: { maintainAspectRatio: false, plugins: { title: { display: true, text: 'æ”»å‡»æˆåŠŸç‡åˆ†å¸ƒ', color: '#fff' } } }
        });

        // 2. æŸ±çŠ¶å›¾ï¼šé£é™©ç­‰çº§åˆ†å¸ƒ
        new Chart(document.getElementById('barChart'), {
            type: 'bar',
            data: {
                labels: ['é«˜å± (High)', 'ä¸­å± (Medium)', 'ä½å± (Low)'],
                datasets: [{
                    label: 'æ¼æ´æ•°é‡',
                    data: [{{ risks.HIGH }}, {{ risks.MEDIUM }}, {{ risks.LOW }}],
                    backgroundColor: ['#ff3b3b', '#ff9f43', '#00d2d3']
                }]
            },
            options: { 
                maintainAspectRatio: false, 
                plugins: { title: { display: true, text: 'æ¼æ´å±å®³ç­‰çº§è¯„ä¼°', color: '#fff' }, legend: { display: false } },
                scales: { y: { beginAtZero: true, ticks: { color: '#fff' } }, x: { ticks: { color: '#fff' } } }
            }
        });
    </script>
</body>
</html>
